<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipe Comments</title>
    <link rel="stylesheet" href="../style.css" />
    <style>
      :root {
        --brand: #7a1ebd;
        --ink: #111827;
        --sub: #6b7280;
        --surface: #ffffff;
        --card: #ffffff;
        --line: #e5e7eb;
        --shadow: 0 6px 24px rgba(0,0,0,.08);
        --radius: 18px;
      }
      
      body { 
        background: #f7f7fb; 
        color: var(--ink); 
        font-family: system-ui, sans-serif; 
        margin: 0;
        padding: 0;
      }

      .back-btn {
        position: fixed;
        top: 20px;
        left: 1070px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: white;
        border: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 20px;
        font-weight: bold;
        color: #333;
      }
      .back-btn:hover { 
        background: #f3f4f6; 
        transform: scale(1.08); 
      }

      .page-title {
        text-align: center;
        margin-top: 90px; 
        font-size: 24px;
        font-weight: bold;
      }

      .producer {
        text-align: center;
        color: #555;
        font-size: 14px;
        margin-bottom: 10px;
      }

      .favourite-btn {
          position: absolute;
          top: 208px;
          right: 1150px;
          background: none;
          border: none;
          cursor: pointer;
          padding: 10px;
          border-radius: 90px;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          width: 46px;
          height: 46px;
      }

      .heart-icon {
          width: 28px;
          height: 28px;
          transition: all 0.3s ease;
      }

      .heart-icon path {
          stroke: #e74c3c;
          stroke-width: 2;
          fill: none;
          transition: all 0.3s ease;
      }

      .favourite-btn.active .heart-icon path {
          fill: #e74c3c;
          stroke: #e74c3c;
      }

      .favourite-btn:hover {
          transform: scale(1.1);
          background: rgba(231, 76, 60, 0.1);
      }

      .favourite-btn:active {
          transform: scale(0.95);
      }


      /* Ratings */
      .rating-section {
        text-align: center;
        margin-top: 20px;
      }

      .stars {
        font-size: 28px;
        color: gold;
        margin: 5px 0;
      }

      .rating-bars {
        margin: 15px auto;
        font-size: 14px;
        max-width: 1024px;
      }

      .rating-bars div {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 6px 0;
      }

      .bar {
        background: #ddd;
        flex: 1;
        height: 8px;
        border-radius: 5px;
        overflow: hidden;
      }

      .fill {
        background: #ffc107;
        height: 100%;
        width: 70%;
      }

      .tags-wrap {
        max-width: 1024px;
        margin: 8px auto 0;
      }

      .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: flex-start;
      }

      .tag {
        display: inline-block;
        padding: 6px 12px;
        border: 2px solid #007aff;
        border-radius: 20px;
        background: white;
        color: #007aff;
        font-size: 14px;
        font-weight: 500;
        white-space: nowrap;
      }

      .comment-box {
        border: 1px solid #ccc;
        border-radius: 12px;
        padding: 12px;
        margin: 20px auto;
        max-width: 1024px;
      }

      .comment-toolbar {
        display: flex;
        gap: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
        margin-bottom: 8px;
      }

      .comment-input {
        width: 100%;
        border: none;
        outline: none;
        resize: none;
        font-size: 14px;
        min-height: 60px;
      }

      .comment-stars {
        text-align: center;
        color: gold;
        margin-top: 10px;
        font-size: 24px;
      }

      .comment {
        border-top: 1px solid #eee;
        padding: 10px 20px;
        max-width: 1024px;
        margin: 0 auto;
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        margin-bottom: 6px;
      }

      .comment-actions {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: #444;
      }

      .media-section {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
      }

      .media-box {
        width: 90px;
        height: 90px;
        background: #eee;
        display: grid;
        place-items: center;
        border-radius: 8px;
        font-size: 12px;
        color: #555;
      }

      .reply-btn {
        background: none;
        border: none;
        color: #007aff;
        font-weight: bold;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
      <div class="container">
          <button class="back-btn" onclick="goBack()">‚Üê</button>

          <button class="favourite-btn" id="favouriteBtn" onclick="toggleFavourite()">
              <svg class="heart-icon" viewBox="0 0 24 24">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
          </button>

            <!-- Tags -->
            <div class="tags-container" id="tags"></div>

          <h1 class="page-title" id="recipeTitle">Recipe Name</h1>
          <p class="producer">By Producer</p>

          <section class="rating-section">
              <p>Rating: <strong id="recipeRating">5.0</strong></p>
              <div class="stars" id="recipeStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
              <p>1,234 ratings</p>
          </section>

          <div class="rating-bars">
              <div>
                  <span>5 star</span>
                  <div class="bar"><div class="fill" style="width: 90%"></div></div>
              </div>
              <div>
                  <span>4 star</span>
                  <div class="bar"><div class="fill" style="width: 68%"></div></div>
              </div>
              <div>
                  <span>3 star</span>
                  <div class="bar"><div class="fill" style="width: 45%"></div></div>
              </div>
              <div>
                  <span>2 star</span>
                  <div class="bar"><div class="fill" style="width: 18%"></div></div>
              </div>
              <div>
                  <span>1 star</span>
                  <div class="bar"><div class="fill" style="width: 7%"></div></div>
              </div>
          </div>

          <div class="tags-wrap">
              <div class="tags-container" id="tagsContainer"></div>
          </div>

          <div class="comment-box">
              <div class="comment-toolbar">
                  <button><b>B</b></button>
                  <button><i>I</i></button>
                  <button><u>U</u></button>
                  <button>üñºÔ∏è</button>
                  <button>üìé</button>
              </div>
              <textarea class="comment-input"
                        placeholder="Your comment..."></textarea>
              <div class="comment-stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
          </div>

          <div class="comment">
              <div class="comment-header">
                  <span><strong>User Name</strong> ‚Ä¢ Jan 12, 2025</span>
                  <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
              </div>
              <p>This recipe was amazing! I'll definitely make it again.</p>
              <div class="comment-actions">
                  <button class="reply-btn">Reply ‚Üì</button>
                  üëç 10 üëé 1
              </div>
          </div>

          <div class="comment">
              <div class="comment-header">
                  <span><strong>Another User</strong> ‚Ä¢ Jan 10, 2025</span>
                  <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span>
              </div>
              <p>Good recipe but could use more seasoning.</p>
              <div class="media-section">
                  <div class="media-box">‚ñ∂ Video</div>
                  <div class="media-box">Picture</div>
                  <div class="media-box">Picture</div>
              </div>
              <div class="comment-actions">
                  <button class="reply-btn">Reply ‚Üì</button>
                  üëç 50 üëé 2
              </div>
          </div>
          <nav class="bottom-nav" id="bottomNav"></nav>
      </div>
      <script src="../script.js"></script>
      <script>

        const urlParams = new URLSearchParams(window.location.search);
        const recipeKey = urlParams.get('recipe');

        if (recipeKey) {
          loadRecipeComments(recipeKey);
        } else {
          console.error('No recipe specified in URL');
          document.getElementById('recipeTitle').textContent = 'Recipe Not Found';
        }

        async function loadRecipeComments(key) {
          const filePath = `../recipes/${key}.json`;
          try {
            const res = await fetch(filePath);
            if (!res.ok) {
              throw new Error(`Failed to fetch recipe: ${res.status}`);
            }
            const recipe = await res.json();

            document.getElementById('recipeTitle').textContent = recipe.title || 'Untitled Recipe';

            const ratingMatch = recipe.rating ? recipe.rating.match(/(\d+\.?\d*)$/) : null;
            const ratingNum = ratingMatch ? parseFloat(ratingMatch[1]) : 5.0;
            document.getElementById('recipeRating').textContent = ratingNum.toFixed(1);

            const fullStars = Math.floor(ratingNum);
            const halfStar = ratingNum % 1 >= 0.5 ? '¬Ω' : '';
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            const starsText = '‚òÖ'.repeat(fullStars) + halfStar + '‚òÜ'.repeat(emptyStars);
            document.getElementById('recipeStars').textContent = starsText;

            const tagsContainer = document.getElementById('tagsContainer');
            tagsContainer.innerHTML = ''; // Clear static tags
            if (recipe.tags && recipe.tags.length > 0) {
              recipe.tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagsContainer.appendChild(tagElement);
              });
            } else {
              tagsContainer.innerHTML = '<p>No tags available.</p>';
            }

          } catch (err) {
            console.error('Error loading recipe for comments:', err);
            document.getElementById('recipeTitle').textContent = 'Failed to Load Recipe';
          }
        }

      function toggleFavourite() {
        const favouriteBtn = document.getElementById('favouriteBtn');
        const heartIcon = favouriteBtn.querySelector('.heart-icon');
        
        favouriteBtn.classList.toggle('active');
        
        if (heartIcon.tagName === 'SPAN') {
            heartIcon.textContent = favouriteBtn.classList.contains('active') ? '‚ô•' : '‚ô°';
          }
        }
      </script>
  </body>
</html>
